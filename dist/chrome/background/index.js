var Pe=Object.defineProperty;var Re=(P,E,D)=>E in P?Pe(P,E,{enumerable:!0,configurable:!0,writable:!0,value:D}):P[E]=D;var Z=(P,E,D)=>(Re(P,typeof E!="symbol"?E+"":E,D),D);(function(){"use strict";var P=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function E(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var D={exports:{}};(function(e,r){(function(s,t){t(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:P,function(s){var t,o;if(!((o=(t=globalThis.chrome)==null?void 0:t.runtime)!=null&&o.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const n="The message port closed before a response was received.",f=p=>{const g={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(g).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class u extends WeakMap{constructor(i,m=void 0){super(m),this.createItem=i}get(i){return this.has(i)||this.set(i,this.createItem(i)),super.get(i)}}const S=a=>a&&typeof a=="object"&&typeof a.then=="function",C=(a,i)=>(...m)=>{p.runtime.lastError?a.reject(new Error(p.runtime.lastError.message)):i.singleCallbackArg||m.length<=1&&i.singleCallbackArg!==!1?a.resolve(m[0]):a.resolve(m)},O=a=>a==1?"argument":"arguments",k=(a,i)=>function(A,...b){if(b.length<i.minArgs)throw new Error(`Expected at least ${i.minArgs} ${O(i.minArgs)} for ${a}(), got ${b.length}`);if(b.length>i.maxArgs)throw new Error(`Expected at most ${i.maxArgs} ${O(i.maxArgs)} for ${a}(), got ${b.length}`);return new Promise((w,y)=>{if(i.fallbackToNoCallback)try{A[a](...b,C({resolve:w,reject:y},i))}catch(c){console.warn(`${a} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,c),A[a](...b),i.fallbackToNoCallback=!1,i.noCallback=!0,w()}else i.noCallback?(A[a](...b),w()):A[a](...b,C({resolve:w,reject:y},i))})},ae=(a,i,m)=>new Proxy(i,{apply(A,b,w){return m.call(b,a,...w)}});let j=Function.call.bind(Object.prototype.hasOwnProperty);const N=(a,i={},m={})=>{let A=Object.create(null),b={has(y,c){return c in a||c in A},get(y,c,v){if(c in A)return A[c];if(!(c in a))return;let x=a[c];if(typeof x=="function")if(typeof i[c]=="function")x=ae(a,a[c],i[c]);else if(j(m,c)){let M=k(c,m[c]);x=ae(a,a[c],M)}else x=x.bind(a);else if(typeof x=="object"&&x!==null&&(j(i,c)||j(m,c)))x=N(x,i[c],m[c]);else if(j(m,"*"))x=N(x,i[c],m["*"]);else return Object.defineProperty(A,c,{configurable:!0,enumerable:!0,get(){return a[c]},set(M){a[c]=M}}),x;return A[c]=x,x},set(y,c,v,x){return c in A?A[c]=v:a[c]=v,!0},defineProperty(y,c,v){return Reflect.defineProperty(A,c,v)},deleteProperty(y,c){return Reflect.deleteProperty(A,c)}},w=Object.create(a);return new Proxy(w,b)},J=a=>({addListener(i,m,...A){i.addListener(a.get(m),...A)},hasListener(i,m){return i.hasListener(a.get(m))},removeListener(i,m){i.removeListener(a.get(m))}}),ke=new u(a=>typeof a!="function"?a:function(m){const A=N(m,{},{getContent:{minArgs:0,maxArgs:0}});a(A)}),ie=new u(a=>typeof a!="function"?a:function(m,A,b){let w=!1,y,c=new Promise(L=>{y=function(T){w=!0,L(T)}}),v;try{v=a(m,A,y)}catch(L){v=Promise.reject(L)}const x=v!==!0&&S(v);if(v!==!0&&!x&&!w)return!1;const M=L=>{L.then(T=>{b(T)},T=>{let K;T&&(T instanceof Error||typeof T.message=="string")?K=T.message:K="An unexpected error occurred",b({__mozWebExtensionPolyfillReject__:!0,message:K})}).catch(T=>{console.error("Failed to send onMessage rejected reply",T)})};return M(x?v:c),!0}),De=({reject:a,resolve:i},m)=>{p.runtime.lastError?p.runtime.lastError.message===n?i():a(new Error(p.runtime.lastError.message)):m&&m.__mozWebExtensionPolyfillReject__?a(new Error(m.message)):i(m)},oe=(a,i,m,...A)=>{if(A.length<i.minArgs)throw new Error(`Expected at least ${i.minArgs} ${O(i.minArgs)} for ${a}(), got ${A.length}`);if(A.length>i.maxArgs)throw new Error(`Expected at most ${i.maxArgs} ${O(i.maxArgs)} for ${a}(), got ${A.length}`);return new Promise((b,w)=>{const y=De.bind(null,{resolve:b,reject:w});A.push(y),m.sendMessage(...A)})},Ie={devtools:{network:{onRequestFinished:J(ke)}},runtime:{onMessage:J(ie),onMessageExternal:J(ie),sendMessage:oe.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:oe.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},H={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return g.privacy={network:{"*":H},services:{"*":H},websites:{"*":H}},N(p,Ie,g)};s.exports=f(chrome)}else s.exports=globalThis.browser})})(D);var ge=D.exports;const l=E(ge);let ce=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((r,s)=>(s&=63,s<36?r+=s.toString(36):s<62?r+=(s-26).toString(36).toUpperCase():s>62?r+="-":r+="_",r),"");function me(e){return{all:e=e||new Map,on:function(r,s){var t=e.get(r);t?t.push(s):e.set(r,[s])},off:function(r,s){var t=e.get(r);t&&(s?t.splice(t.indexOf(s)>>>0,1):e.set(r,[]))},emit:function(r,s){var t=e.get(r);t&&t.slice().map(function(o){o(s)}),(t=e.get("*"))&&t.slice().map(function(o){o(r,s)})}}}class le{constructor(){Z(this,"services",new Map);Z(this,"emitter",me());l.runtime.onMessage.addListener(((r,s)=>{const t=JSON.parse(r);if(!t||!t.type){console.error(`Bad message: ${r}`);return}switch(t.type){case"event":this.emitter.emit(t.event,{detail:t.detail,sender:s});break;case"service":{const o=this.services.get(t.service);if(!o)break;return o(t.params,s)}default:console.error(`Unknown message type: ${t.type}`);break}}).bind(this))}provide(r,s){return this.services.set(r,s),()=>{this.services.delete(r)}}request(r,s){const t=JSON.stringify({type:"service",service:r,params:s});return l.runtime.sendMessage(t)}requestToTab(r,s,t){if(!l.tabs||!l.tabs.sendMessage)return Promise.reject("Can not send message to tabs in current context!");const o=JSON.stringify({type:"service",service:s,params:t});return l.tabs.sendMessage(r,o)}on(r,s){const t=o=>{s(o.detail,o.sender)};return this.emitter.on(r,t)}emit(r,s){const t=JSON.stringify({type:"event",event:r,detail:s});l.runtime.sendMessage(t)}emitToTabs(r,s,t){if(!l.tabs||!l.tabs.sendMessage)return Promise.reject("Can not send message to tabs in current context!");typeof r=="number"&&(r=[r]);const o=JSON.stringify({type:"event",event:s,detail:t});r.forEach(n=>void l.tabs.sendMessage(n,o))}async getCurrentTabId(){return(await l.tabs.query({active:!0,currentWindow:!0}))[0].id||-1}}var z=(e=>(e.settings="settings",e))(z||{}),h=(e=>(e.recorderStatus="recorder_status",e))(h||{}),d=(e=>(e.IDLE="IDLE",e.RECORDING="RECORDING",e.PAUSED="PAUSED",e.PausedSwitch="PAUSED_SWITCH",e))(d||{}),B=(e=>(e.StartRecord="start-record",e.StopRecord="stop-record",e))(B||{}),R=(e=>(e.SessionUpdated="session-updated",e.ContentScriptEmitEvent="content-script-emit-event",e.StartButtonClicked="start-recording-button-clicked",e.StopButtonClicked="stop-recording-button-clicked",e.PauseButtonClicked="pause-recording-button-clicked",e.ResumeButtonClicked="resume-recording-button-clicked",e))(R||{}),Q=(e=>(e.RecordScriptReady="rrweb-extension-record-script-ready",e.StartRecord="rrweb-extension-start-record",e.RecordStarted="rrweb-extension-record-started",e.StopRecord="rrweb-extension-stop-record",e.RecordStopped="rrweb-extension-record-stopped",e.EmitEvent="rrweb-extension-emit-event",e))(Q||{});function Ae(){var e;return typeof window<"u"&&((e=window.navigator)==null?void 0:e.userAgent.toLowerCase().includes("firefox"))||!1}const ue=(e,r)=>r.some(s=>e instanceof s);let X,Y;function de(){return X||(X=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fe(){return Y||(Y=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ee=new WeakMap,F=new WeakMap,re=new WeakMap,U=new WeakMap,_=new WeakMap;function xe(e){const r=new Promise((s,t)=>{const o=()=>{e.removeEventListener("success",n),e.removeEventListener("error",f)},n=()=>{s(I(e.result)),o()},f=()=>{t(e.error),o()};e.addEventListener("success",n),e.addEventListener("error",f)});return r.then(s=>{s instanceof IDBCursor&&ee.set(s,e)}).catch(()=>{}),_.set(r,e),r}function be(e){if(F.has(e))return;const r=new Promise((s,t)=>{const o=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",f),e.removeEventListener("abort",f)},n=()=>{s(),o()},f=()=>{t(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",n),e.addEventListener("error",f),e.addEventListener("abort",f)});F.set(e,r)}let $={get(e,r,s){if(e instanceof IDBTransaction){if(r==="done")return F.get(e);if(r==="objectStoreNames")return e.objectStoreNames||re.get(e);if(r==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return I(e[r])},set(e,r,s){return e[r]=s,!0},has(e,r){return e instanceof IDBTransaction&&(r==="done"||r==="store")?!0:r in e}};function pe(e){$=e($)}function we(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(r,...s){const t=e.call(W(this),r,...s);return re.set(t,r.sort?r.sort():[r]),I(t)}:fe().includes(e)?function(...r){return e.apply(W(this),r),I(ee.get(this))}:function(...r){return I(e.apply(W(this),r))}}function he(e){return typeof e=="function"?we(e):(e instanceof IDBTransaction&&be(e),ue(e,de())?new Proxy(e,$):e)}function I(e){if(e instanceof IDBRequest)return xe(e);if(U.has(e))return U.get(e);const r=he(e);return r!==e&&(U.set(e,r),_.set(r,e)),r}const W=e=>_.get(e);function se(e,r,{blocked:s,upgrade:t,blocking:o,terminated:n}={}){const f=indexedDB.open(e,r),p=I(f);return t&&f.addEventListener("upgradeneeded",g=>{t(I(f.result),g.oldVersion,g.newVersion,I(f.transaction),g)}),s&&f.addEventListener("blocked",g=>s(g.oldVersion,g.newVersion,g)),p.then(g=>{n&&g.addEventListener("close",()=>n()),o&&g.addEventListener("versionchange",u=>o(u.oldVersion,u.newVersion,u))}).catch(()=>{}),p}const ye=["get","getKey","getAll","getAllKeys","count"],ve=["put","add","delete","clear"],q=new Map;function te(e,r){if(!(e instanceof IDBDatabase&&!(r in e)&&typeof r=="string"))return;if(q.get(r))return q.get(r);const s=r.replace(/FromIndex$/,""),t=r!==s,o=ve.includes(s);if(!(s in(t?IDBIndex:IDBObjectStore).prototype)||!(o||ye.includes(s)))return;const n=async function(f,...p){const g=this.transaction(f,o?"readwrite":"readonly");let u=g.store;return t&&(u=u.index(p.shift())),(await Promise.all([u[s](...p),o&&g.done]))[0]};return q.set(r,n),n}pe(e=>({...e,get:(r,s,t)=>te(r,s)||e.get(r,s,t),has:(r,s)=>!!te(r,s)||e.has(r,s)}));const G="events";async function Se(){return se(G,1,{upgrade(e){e.createObjectStore(G,{keyPath:"id",autoIncrement:!1})}})}const V="sessions";async function Te(){return se(V,1,{upgrade(e){e.createObjectStore(V,{keyPath:"id",autoIncrement:!1})}})}async function Ee(e,r){await(await Se()).put(G,{id:e.id,events:r}),await(await Te()).add(V,e)}(async()=>{const e=await l.storage.sync.get(z.settings)||void 0,r={};let s=r;e&&e.settings&&(ne(e.settings,r),s=e.settings),await l.storage.sync.set({settings:s});const t=[],o=new le;let n={status:d.IDLE,activeTabId:-1};await l.storage.local.set({[h.recorderStatus]:n}),o.on(R.StartButtonClicked,async()=>{if(n.status!==d.IDLE)return;n={status:d.IDLE,activeTabId:-1},await l.storage.local.set({[h.recorderStatus]:n}),t.length=0;const g=await o.getCurrentTabId();if(g===-1)return;const u=await o.requestToTab(g,B.StartRecord,{}).catch(async S=>{n.errorMessage=S.message,await l.storage.local.set({[h.recorderStatus]:n})});u&&(Object.assign(n,{status:d.RECORDING,activeTabId:g,startTimestamp:u.startTimestamp}),await l.storage.local.set({[h.recorderStatus]:n}))}),o.on(R.StopButtonClicked,async()=>{if(n.status===d.IDLE)return;n.status===d.RECORDING&&await o.requestToTab(n.activeTabId,B.StopRecord,{}).catch(()=>({message:Q.RecordStopped,endTimestamp:Date.now()})),n={status:d.IDLE,activeTabId:-1},await l.storage.local.set({[h.recorderStatus]:n});const g=await l.tabs.query({active:!0,currentWindow:!0}).then(S=>{var C;return(C=S[0])==null?void 0:C.title}).catch(()=>{})??"new session",u=Ce(g);await Ee(u,t).catch(S=>{n.errorMessage=S.message,l.storage.local.set({[h.recorderStatus]:n})}),o.emit(R.SessionUpdated,{session:u}),t.length=0});async function f(g){if(n.status!==d.RECORDING||n.activeTabId===-1)return;const u=await o.requestToTab(n.activeTabId,B.StopRecord,{}).catch(()=>{});Object.assign(n,{status:g,activeTabId:-1,pausedTimestamp:u==null?void 0:u.endTimestamp}),await l.storage.local.set({[h.recorderStatus]:n})}o.on(R.PauseButtonClicked,async()=>{n.status===d.RECORDING&&await f(d.PAUSED)});async function p(g){if(![d.PAUSED,d.PausedSwitch].includes(n.status))return;const{startTimestamp:u,pausedTimestamp:S}=n;Ae()&&await new Promise(k=>setTimeout(k,50));const C=S?Date.now()-S:0;if(t.forEach(k=>{k.timestamp+=C}),!await o.requestToTab(g,B.StartRecord,{}).catch(k=>{n.errorMessage=k.message,l.storage.local.set({[h.recorderStatus]:n})})){t.forEach(k=>{k.timestamp-=C});return}n={status:d.RECORDING,activeTabId:g,startTimestamp:(u||Date.now())+C},await l.storage.local.set({[h.recorderStatus]:n})}o.on(R.ResumeButtonClicked,async()=>{if(n.status!==d.PAUSED)return;n.errorMessage=void 0,await l.storage.local.set({[h.recorderStatus]:n});const g=await o.getCurrentTabId();await p(g)}),o.on(R.ContentScriptEmitEvent,g=>{t.push(g)}),l.tabs.onActivated.addListener(g=>{(async()=>n.status!==d.RECORDING&&n.status!==d.PausedSwitch||g.tabId!==n.activeTabId&&(n.status===d.RECORDING&&await f(d.PausedSwitch),n.status===d.PausedSwitch&&await p(g.tabId)))()}),l.tabs.onUpdated.addListener(function(g,u){u.status==="complete"&&(n.status!==d.PausedSwitch||n.activeTabId===g||p(g))}),l.tabs.onRemoved.addListener(g=>{(async()=>n.activeTabId!==g||n.status!==d.RECORDING||(Object.assign(n,{status:d.PausedSwitch,activeTabId:-1,pausedTimestamp:Date.now()}),await l.storage.local.set({[h.recorderStatus]:n})))()})})();function ne(e,r){for(const s in r)typeof r[s]=="object"&&!(r[s]instanceof Array)&&Object.keys(r[s]).length>0?e[s]?ne(e[s],r[s]):e[s]=r[s]:e[s]===void 0&&(e[s]=r[s])}function Ce(e){return{id:ce(),name:e,tags:[],createTimestamp:Date.now(),modifyTimestamp:Date.now(),recorderVersion:l.runtime.getManifest().version_name||"unknown"}}})();
