var se=Object.defineProperty;var te=(y,b,w)=>b in y?se(y,b,{enumerable:!0,configurable:!0,writable:!0,value:w}):y[b]=w;var _=(y,b,w)=>(te(y,typeof b!="symbol"?b+"":b,w),w);(function(){"use strict";var y=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function b(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var w={exports:{}};(function(e,n){(function(g,t){t(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:y,function(g){var t,o;if(!((o=(t=globalThis.chrome)==null?void 0:t.runtime)!=null&&o.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const p="The message port closed before a response was received.",K=v=>{const j={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(j).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class N extends WeakMap{constructor(s,a=void 0){super(a),this.createItem=s}get(s){return this.has(s)||this.set(s,this.createItem(s)),super.get(s)}}const Q=r=>r&&typeof r=="object"&&typeof r.then=="function",D=(r,s)=>(...a)=>{v.runtime.lastError?r.reject(new Error(v.runtime.lastError.message)):s.singleCallbackArg||a.length<=1&&s.singleCallbackArg!==!1?r.resolve(a[0]):r.resolve(a)},T=r=>r==1?"argument":"arguments",X=(r,s)=>function(m,...l){if(l.length<s.minArgs)throw new Error(`Expected at least ${s.minArgs} ${T(s.minArgs)} for ${r}(), got ${l.length}`);if(l.length>s.maxArgs)throw new Error(`Expected at most ${s.maxArgs} ${T(s.maxArgs)} for ${r}(), got ${l.length}`);return new Promise((d,u)=>{if(s.fallbackToNoCallback)try{m[r](...l,D({resolve:d,reject:u},s))}catch(i){console.warn(`${r} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,i),m[r](...l),s.fallbackToNoCallback=!1,s.noCallback=!0,d()}else s.noCallback?(m[r](...l),d()):m[r](...l,D({resolve:d,reject:u},s))})},U=(r,s,a)=>new Proxy(s,{apply(m,l,d){return a.call(l,r,...d)}});let P=Function.call.bind(Object.prototype.hasOwnProperty);const M=(r,s={},a={})=>{let m=Object.create(null),l={has(u,i){return i in r||i in m},get(u,i,x){if(i in m)return m[i];if(!(i in r))return;let A=r[i];if(typeof A=="function")if(typeof s[i]=="function")A=U(r,r[i],s[i]);else if(P(a,i)){let C=X(i,a[i]);A=U(r,r[i],C)}else A=A.bind(r);else if(typeof A=="object"&&A!==null&&(P(s,i)||P(a,i)))A=M(A,s[i],a[i]);else if(P(a,"*"))A=M(A,s[i],a["*"]);else return Object.defineProperty(m,i,{configurable:!0,enumerable:!0,get(){return r[i]},set(C){r[i]=C}}),A;return m[i]=A,A},set(u,i,x,A){return i in m?m[i]=x:r[i]=x,!0},defineProperty(u,i,x){return Reflect.defineProperty(m,i,x)},deleteProperty(u,i){return Reflect.deleteProperty(m,i)}},d=Object.create(r);return new Proxy(d,l)},B=r=>({addListener(s,a,...m){s.addListener(r.get(a),...m)},hasListener(s,a){return s.hasListener(r.get(a))},removeListener(s,a){s.removeListener(r.get(a))}}),Y=new N(r=>typeof r!="function"?r:function(a){const m=M(a,{},{getContent:{minArgs:0,maxArgs:0}});r(m)}),q=new N(r=>typeof r!="function"?r:function(a,m,l){let d=!1,u,i=new Promise(S=>{u=function(f){d=!0,S(f)}}),x;try{x=r(a,m,u)}catch(S){x=Promise.reject(S)}const A=x!==!0&&Q(x);if(x!==!0&&!A&&!d)return!1;const C=S=>{S.then(f=>{l(f)},f=>{let F;f&&(f instanceof Error||typeof f.message=="string")?F=f.message:F="An unexpected error occurred",l({__mozWebExtensionPolyfillReject__:!0,message:F})}).catch(f=>{console.error("Failed to send onMessage rejected reply",f)})};return C(A?x:i),!0}),ee=({reject:r,resolve:s},a)=>{v.runtime.lastError?v.runtime.lastError.message===p?s():r(new Error(v.runtime.lastError.message)):a&&a.__mozWebExtensionPolyfillReject__?r(new Error(a.message)):s(a)},W=(r,s,a,...m)=>{if(m.length<s.minArgs)throw new Error(`Expected at least ${s.minArgs} ${T(s.minArgs)} for ${r}(), got ${m.length}`);if(m.length>s.maxArgs)throw new Error(`Expected at most ${s.maxArgs} ${T(s.maxArgs)} for ${r}(), got ${m.length}`);return new Promise((l,d)=>{const u=ee.bind(null,{resolve:l,reject:d});m.push(u),a.sendMessage(...m)})},re={devtools:{network:{onRequestFinished:B(Y)}},runtime:{onMessage:B(q),onMessageExternal:B(q),sendMessage:W.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:W.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},$={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return j.privacy={network:{"*":$},services:{"*":$},websites:{"*":$}},M(v,re,j)};g.exports=K(chrome)}else g.exports=globalThis.browser})})(w);var G=w.exports;const c=b(G);var k=(e=>(e.recorderStatus="recorder_status",e))(k||{}),E=(e=>(e.IDLE="IDLE",e.RECORDING="RECORDING",e.PAUSED="PAUSED",e.PausedSwitch="PAUSED_SWITCH",e))(E||{}),O=(e=>(e.StartRecord="start-record",e.StopRecord="stop-record",e))(O||{}),I=(e=>(e.SessionUpdated="session-updated",e.ContentScriptEmitEvent="content-script-emit-event",e.StartButtonClicked="start-recording-button-clicked",e.StopButtonClicked="stop-recording-button-clicked",e.PauseButtonClicked="pause-recording-button-clicked",e.ResumeButtonClicked="resume-recording-button-clicked",e))(I||{}),h=(e=>(e.RecordScriptReady="rrweb-extension-record-script-ready",e.StartRecord="rrweb-extension-start-record",e.RecordStarted="rrweb-extension-record-started",e.StopRecord="rrweb-extension-stop-record",e.RecordStopped="rrweb-extension-record-stopped",e.EmitEvent="rrweb-extension-emit-event",e))(h||{});function J(e){return{all:e=e||new Map,on:function(n,g){var t=e.get(n);t?t.push(g):e.set(n,[g])},off:function(n,g){var t=e.get(n);t&&(g?t.splice(t.indexOf(g)>>>0,1):e.set(n,[]))},emit:function(n,g){var t=e.get(n);t&&t.slice().map(function(o){o(g)}),(t=e.get("*"))&&t.slice().map(function(o){o(n,g)})}}}class H{constructor(){_(this,"services",new Map);_(this,"emitter",J());c.runtime.onMessage.addListener(((n,g)=>{const t=JSON.parse(n);if(!t||!t.type){console.error(`Bad message: ${n}`);return}switch(t.type){case"event":this.emitter.emit(t.event,{detail:t.detail,sender:g});break;case"service":{const o=this.services.get(t.service);if(!o)break;return o(t.params,g)}default:console.error(`Unknown message type: ${t.type}`);break}}).bind(this))}provide(n,g){return this.services.set(n,g),()=>{this.services.delete(n)}}request(n,g){const t=JSON.stringify({type:"service",service:n,params:g});return c.runtime.sendMessage(t)}requestToTab(n,g,t){if(!c.tabs||!c.tabs.sendMessage)return Promise.reject("Can not send message to tabs in current context!");const o=JSON.stringify({type:"service",service:g,params:t});return c.tabs.sendMessage(n,o)}on(n,g){const t=o=>{g(o.detail,o.sender)};return this.emitter.on(n,t)}emit(n,g){const t=JSON.stringify({type:"event",event:n,detail:g});c.runtime.sendMessage(t)}emitToTabs(n,g,t){if(!c.tabs||!c.tabs.sendMessage)return Promise.reject("Can not send message to tabs in current context!");typeof n=="number"&&(n=[n]);const o=JSON.stringify({type:"event",event:g,detail:t});n.forEach(p=>void c.tabs.sendMessage(p,o))}async getCurrentTabId(){return(await c.tabs.query({active:!0,currentWindow:!0}))[0].id||-1}}function Z(){if(window.parent!==window)try{window.parent.location.origin}catch{return!0}return!1}const L=new H;window.addEventListener("message",e=>{e.source===window&&e.data.message===h.RecordScriptReady&&window.postMessage({message:h.StartRecord,config:{recordCrossOriginIframes:!0}},location.origin)}),Z()?V():window===window.top&&z();async function z(){var t;let e;L.provide(O.StartRecord,async()=>(R(),new Promise(o=>{e=p=>{o(p)}})));let n;L.provide(O.StopRecord,()=>(window.postMessage({message:h.StopRecord}),new Promise(o=>{n=p=>{n=void 0,o(p)}}))),window.addEventListener("message",o=>{if(o.source===window)if(o.data.message===h.RecordStarted&&e)e(o.data);else if(o.data.message===h.RecordStopped&&n){const p={...o.data};n(p)}else o.data.message===h.EmitEvent&&L.emit(I.ContentScriptEmitEvent,o.data.event)});const g=await c.storage.local.get();((t=g==null?void 0:g[k.recorderStatus])==null?void 0:t.status)===E.RECORDING&&R()}async function V(){var n;c.storage.local.onChanged.addListener(g=>{g[k.recorderStatus]&&(g[k.recorderStatus].newValue.status===E.RECORDING?R():window.postMessage({message:h.StopRecord},location.origin))});const e=await c.storage.local.get();((n=e==null?void 0:e[k.recorderStatus])==null?void 0:n.status)===E.RECORDING&&R()}function R(){const e=document.createElement("script");e.src=c.runtime.getURL("content/inject.js"),document.documentElement.appendChild(e),e.onload=()=>{document.documentElement.removeChild(e)}}})();
