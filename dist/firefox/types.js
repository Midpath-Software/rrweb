var o=Object.defineProperty;var u=(t,e,r)=>e in t?o(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var a=(t,e,r)=>(u(t,typeof e!="symbol"?e+"":e,r),r);import{d,h as i}from"./browser-polyfill.js";var p=d("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});p.displayName="Spacer";function g(t){return{all:t=t||new Map,on:function(e,r){var s=t.get(e);s?s.push(r):t.set(e,[r])},off:function(e,r){var s=t.get(e);s&&(r?s.splice(s.indexOf(r)>>>0,1):t.set(e,[]))},emit:function(e,r){var s=t.get(e);s&&s.slice().map(function(n){n(r)}),(s=t.get("*"))&&s.slice().map(function(n){n(e,r)})}}}class y{constructor(){a(this,"services",new Map);a(this,"emitter",g());i.runtime.onMessage.addListener(((e,r)=>{const s=JSON.parse(e);if(!s||!s.type){console.error(`Bad message: ${e}`);return}switch(s.type){case"event":this.emitter.emit(s.event,{detail:s.detail,sender:r});break;case"service":{const n=this.services.get(s.service);if(!n)break;return n(s.params,r)}default:console.error(`Unknown message type: ${s.type}`);break}}).bind(this))}provide(e,r){return this.services.set(e,r),()=>{this.services.delete(e)}}request(e,r){const s=JSON.stringify({type:"service",service:e,params:r});return i.runtime.sendMessage(s)}requestToTab(e,r,s){if(!i.tabs||!i.tabs.sendMessage)return Promise.reject("Can not send message to tabs in current context!");const n=JSON.stringify({type:"service",service:r,params:s});return i.tabs.sendMessage(e,n)}on(e,r){const s=n=>{r(n.detail,n.sender)};return this.emitter.on(e,s)}emit(e,r){const s=JSON.stringify({type:"event",event:e,detail:r});i.runtime.sendMessage(s)}emitToTabs(e,r,s){if(!i.tabs||!i.tabs.sendMessage)return Promise.reject("Can not send message to tabs in current context!");typeof e=="number"&&(e=[e]);const n=JSON.stringify({type:"event",event:r,detail:s});e.forEach(c=>void i.tabs.sendMessage(c,n))}async getCurrentTabId(){return(await i.tabs.query({active:!0,currentWindow:!0}))[0].id||-1}}var l=(t=>(t.recorderStatus="recorder_status",t))(l||{}),f=(t=>(t.IDLE="IDLE",t.RECORDING="RECORDING",t.PAUSED="PAUSED",t.PausedSwitch="PAUSED_SWITCH",t))(f||{}),m=(t=>(t.SessionUpdated="session-updated",t.ContentScriptEmitEvent="content-script-emit-event",t.StartButtonClicked="start-recording-button-clicked",t.StopButtonClicked="stop-recording-button-clicked",t.PauseButtonClicked="pause-recording-button-clicked",t.ResumeButtonClicked="resume-recording-button-clicked",t))(m||{});export{y as C,m as E,l as L,f as R,p as S};
